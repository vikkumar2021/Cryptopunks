<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

</body>
</html><!DOCTYPE html>
<head>
<meta charset="utf-8">
<title>Multi Line Chart</title>
<script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>
<link rel="stylesheet" type="text/css" href="styles.css">
<style></style>
</head>
<body>
<div id="container" class="svg-container"></div>
<script>
//------------------------1. PREPARATION------------------------//
//-----------------------------SVG------------------------------//


const width = 960;
const height = 500;
const margin = 5;
const padding = 5;
const adj = 30;
// we are appending SVG first
const svg = d3.select("div#container").append("svg")
    .attr("preserveAspectRatio", "xMinYMin meet")
    .attr("viewBox", "-"
          + adj + " -"
          + adj + " "
          + (width + adj *3) + " "
          + (height + adj*3))
    .style("padding", padding)
    .style("margin", margin)
    .classed("svg-content", true);

//-----------------------------DATA-----------------------------//

// var url = "http://127.0.0.1:5001/run_qlearner?ticker=BTC&training_sd=2017-05-01&training_ed=2018-05-01&test_sd=2018-05-02&test_ed=2019-02-01&sv=500000&sma_window=14&bollinger_band_sma=14&bollinger_band_stdev=3&so_window=14&so_window_sma=14&obv=False&macd=True&include_sentiment=False&mom_window=14&alpha=0.1&gamma=0.9&rar=0.99&radr=0.8&sma_threshold=0.2&so_ul=80&so_ll=20&mom_threshold=0.2&sentiment_threshold=0.3";
// console.log(url);

// Model/Pipeline Parameters
var params = {
"ticker": "BTC",
"training_sd": "2017-05-01", //mandatory
"training_ed": "2018-05-01",
"test_sd": "2018-05-02",
"test_ed": "2019-02-01",
"sv": 500000,
"sma_window": 14,
"bollinger_window": 14,
"bollinger_stdvs": 3,
"so_window": 14,
"so_window_sma": 14,
"obv": true,
"macd": true,
"include_sentiment": true,
"mom_window": 14,
"alpha": 0.1,
"gamma": 0.9,
"rar": 0.99,
"radr": 0.8,
"sma_threshold": 0.2,
"so_ul": 80,
"so_ll": 20,
"mom_threshold": 0.2,
"sentiment_threshold": 0.3
};



var queryString = Object.keys(params).map(function(key) {
return key + '=' + params[key]
}).join('&');
//console.log(queryString);



var url = "http://127.0.0.1:5001/run_qlearner?" + queryString
console.log(url);

var dataset2 = fetch(url)
    .then(response => response.json())
    .then(function(data) {

        //console.log(data)
        let time = data[0]['TradeDate']
        //var parseDate = d3.timeParse("%a, %d %b %Y %H:%M:%S GMT");
        var parseDate = d3.timeParse("%Y-%m-%d");
        console.log(time)
        // console.log(parseDate(time))
        // console.log(typeof data)
        // console.log(data.keys())
        console.log(data)
        console.log(data[0])
        const cols = data[0]
        var indicatorSet = {id: {'Adj_Close': {values: []}, 'rolling_avg': {values: []}}}
        //var inds = [{id: {'Adj_Close': {values: []}}}, {id: {'rolling_avg': {values: []}}}]
        var inds = [{id: 'Adj_Close', values: []}, {id: 'rolling_avg', values: []}, {id: 'bollinger_band_lower', values: []}, {id: 'bollinger_band_upper', values: []}]
        for (const [key, value] of Object.entries(data)) {
            let date = value.TradeDate;
            for (const [id, measurement] of Object.entries(value)) {
                if (id === 'Adj_Close') {
                    //console.log(measurement)
                    inds[0].values.push({date: parseDate(date), measurement: +measurement})
                }
                else if (id === 'rolling_avg') {
                    inds[1].values.push({date: parseDate(date), measurement: +measurement})
                }
                else if (id === 'bollinger_band_lower') {
                    inds[2].values.push({date: parseDate(date), measurement: +measurement})
                }
                else if (id === 'bollinger_band_upper') {
                    inds[3].values.push({date: parseDate(date), measurement: +measurement})
                }
            }
        }
        console.log(inds)
    //     var dataset5 = data.entries(key,value).map(function (d) {
    //         return {
    //         id: 'Adj_Close',
    //         values: data.map(function(d){
    //             return {
    //                 date: parseDate(d.date),
    //                 measurement: +d[0]
    //             };
    //         })
    //     };
    // });



const timeConv = d3.timeParse("%d-%b-%Y");
//const timeConv = d3.timeParse("%Y-%m-%d");
const dataset = d3.csv("data2.csv");
// dataset.then(function(data) {
//     var slices = data.columns.slice(1).map(function (id) {
//         return {
//             id: id,
//             values: data.map(function (d) {
//                 return {
//                     date: timeConv(d.date),
//                     measurement: +d[id]
//                 };
//             })
//         };
//     });
    slices = inds
    console.log(dataset)
    console.log(slices)
    //console.log(typeof slices)

//----------------------------SCALES----------------------------//
    const xScale = d3.scaleTime().range([0, width]);
    const yScale = d3.scaleLinear().rangeRound([height, 0]);
    xScale.domain(d3.extent(data, function (d) {
        return parseDate(d.TradeDate)
    }));
    yScale.domain([(0), (30000)]);

//-----------------------------AXES-----------------------------//
    const yaxis = d3.axisLeft()
        .ticks(20)
        .scale(yScale);

    const xaxis = d3.axisBottom()
        .ticks(50)
        .tickFormat(d3.timeFormat('%b %d'))
        .scale(xScale);

//----------------------------LINES-----------------------------//
    const line = d3.line()
        .x(function (d) {
            return xScale(d.date);
        })
        .y(function (d) {
            return yScale(d.measurement);
        });

    let id = 0;
    const ids = function () {
        console.log("line-" + id)
        return "line-" + id++;
    }
//-------------------------2. DRAWING---------------------------//
//-----------------------------AXES-----------------------------//
    svg.append("g")
        .attr("class", "axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xaxis);

    svg.append("g")
        .attr("class", "axis")
        .call(yaxis)
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("dy", ".75em")
        .attr("y", 6)
        .style("text-anchor", "end")
        .text("Frequency");

//----------------------------LINES-----------------------------//
    const lines = svg.selectAll("lines")
        .data(slices)
        .enter()
        .append("g");

    lines.append("path")
        .attr("class", ids)
        //.attr("class", "line-2")
        .attr("d", function (d) {
            return line(d.values);
        });

    lines.append("text")
        .attr("class", "serie_label")
        .datum(function (d) {
            return {
                id: d.id,
                value: d.values[d.values.length - 1]
            };
        })
        .attr("transform", function (d) {
            return "translate(" + (xScale(d.value.date) + 10)
                + "," + (yScale(d.value.measurement) + 5) + ")";
        })
        .attr("x", 5)
        .text(function (d) {
            return ("Serie ") + d.id;
        });

//})
});


// we are appending SVG first
const svg2 = d3.select("div#container").append("svg")
    .attr("secondChart", "xMinYMin meet")
    .attr("viewBox", "-"
          + adj + " -"
          + adj + " "
          + (width + adj *3) + " "
          + (height + adj*3))
    .style("padding", padding)
    .style("margin", margin)
    .classed("svg-content", true)

var dataset2 = fetch(url)
    .then(response => response.json())
    .then(function(data) {

        //console.log(data)
        let time = data[0]['TradeDate']
        //var parseDate = d3.timeParse("%a, %d %b %Y %H:%M:%S GMT");
        var parseDate = d3.timeParse("%Y-%m-%d");
        //console.log(time)
        // console.log(parseDate(time))
        // console.log(typeof data)
        // console.log(data.keys())
        // console.log(data)
        // console.log(data[0])
        const cols = data[0]
        var indicatorSet = {id: {'Adj_Close': {values: []}, 'rolling_avg': {values: []}}}
        //var inds = [{id: {'Adj_Close': {values: []}}}, {id: {'rolling_avg': {values: []}}}]
        var inds = [{id: 'MACD', values: []}, {id: 'MACD_raw', values: []}, {id: 'MACD_signal', values: []}]
        for (const [key, value] of Object.entries(data)) {
            let date = value.TradeDate;
            for (const [id, measurement] of Object.entries(value)) {
                if (id === 'MACD') {
                    //console.log(measurement)
                    inds[0].values.push({date: parseDate(date), measurement: +measurement})
                }
                else if (id === 'MACD_raw') {
                    inds[1].values.push({date: parseDate(date), measurement: +measurement})
                }
                else if (id === 'MACD_signal') {
                    inds[2].values.push({date: parseDate(date), measurement: +measurement})
                }

            }
        }

    slices = inds

    //console.log(typeof slices)

//----------------------------SCALES----------------------------//
    const xScale = d3.scaleTime().range([0, width]);
    const yScale = d3.scaleLinear().rangeRound([height, 0]);
    xScale.domain(d3.extent(data, function (d) {
        return parseDate(d.TradeDate)
    }));
    yScale.domain([(-1500), (2500)]);

//-----------------------------AXES-----------------------------//
    const yaxis = d3.axisLeft()
        .ticks(20)
        .scale(yScale);

    const xaxis = d3.axisBottom()
        .ticks(50)
        .tickFormat(d3.timeFormat('%b %d'))
        .scale(xScale);

//----------------------------LINES-----------------------------//
    const line = d3.line()
        .x(function (d) {
            return xScale(d.date);
        })
        .y(function (d) {
            return yScale(d.measurement);
        });

    let id = 0;
    const ids = function () {
        console.log("line-" + id)
        return "line-" + id++;
    }
//-------------------------2. DRAWING---------------------------//
//-----------------------------AXES-----------------------------//
    svg2.append("g")
        .attr("class", "axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xaxis);

    svg2.append("g")
        .attr("class", "axis")
        .call(yaxis)
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("dy", ".75em")
        .attr("y", 6)
        .style("text-anchor", "end")
        .text("Frequency");

//----------------------------LINES-----------------------------//
    const lines = svg2.selectAll("lines")
        .data(slices)
        .enter()
        .append("g");

    lines.append("path")
        .attr("class", ids)
        //.attr("class", "line-2")
        .attr("d", function (d) {
            return line(d.values);
        });

    lines.append("text")
        .attr("class", "serie_label")
        .datum(function (d) {
            return {
                id: d.id,
                value: d.values[d.values.length - 1]
            };
        })
        .attr("transform", function (d) {
            return "translate(" + (xScale(d.value.date) + 10)
                + "," + (yScale(d.value.measurement) + 5) + ")";
        })
        .attr("x", -150)
        .attr("y", -150)
        .text(function (d) {
            return ("Series ") + d.id;
        });

//})
});

/////###############BOLLINGER_BAND_PERCENTAGE##############
// we are appending SVG first
const svg3 = d3.select("div#container").append("svg")
    .attr("chart", "bollinger_band_percentage")
    .attr("viewBox", "-"
          + adj + " -"
          + adj + " "
          + (width + adj *3) + " "
          + (height + adj*3))
    .style("padding", padding)
    .style("margin", margin)
    .classed("svg-content", true)

var bollinger_band_percentage = fetch(url)
    .then(response => response.json())
    .then(function(data) {

        //console.log(data)
        let time = data[0]['TradeDate']
        //var parseDate = d3.timeParse("%a, %d %b %Y %H:%M:%S GMT");
        var parseDate = d3.timeParse("%Y-%m-%d");
        //console.log(time)
        // console.log(parseDate(time))
        // console.log(typeof data)
        // console.log(data.keys())
        // console.log(data)
        // console.log(data[0])
        const cols = data[0]
        var indicatorSet = {id: {'Adj_Close': {values: []}, 'rolling_avg': {values: []}}}
        //var inds = [{id: {'Adj_Close': {values: []}}}, {id: {'rolling_avg': {values: []}}}]
        var inds = [{id: 'bollinger_band_percentage', values: []}]
        for (const [key, value] of Object.entries(data)) {
            let date = value.TradeDate;
            for (const [id, measurement] of Object.entries(value)) {
                if (id === 'bollinger_band_percentage') {
                    //console.log(measurement)
                    inds[0].values.push({date: parseDate(date), measurement: +measurement})
                }

            }
        }

    slices = inds

    //console.log(typeof slices)

//----------------------------SCALES----------------------------//
    const xScale = d3.scaleTime().range([0, width]);
    const yScale = d3.scaleLinear().rangeRound([height, 0]);
    xScale.domain(d3.extent(data, function (d) {
        return parseDate(d.TradeDate)
    }));
    yScale.domain([(0), (1)]);

//-----------------------------AXES-----------------------------//
    const yaxis = d3.axisLeft()
        .ticks(20)
        .scale(yScale);

    const xaxis = d3.axisBottom()
        .ticks(50)
        .tickFormat(d3.timeFormat('%b %d'))
        .scale(xScale);

//----------------------------LINES-----------------------------//
    const line = d3.line()
        .x(function (d) {
            return xScale(d.date);
        })
        .y(function (d) {
            return yScale(d.measurement);
        });

    let id = 0;
    const ids = function () {
        console.log("line-" + id)
        return "line-" + id++;
    }
//-------------------------2. DRAWING---------------------------//
//-----------------------------AXES-----------------------------//
    svg3.append("g")
        .attr("class", "axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xaxis);

    svg3.append("g")
        .attr("class", "axis")
        .call(yaxis)
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("dy", ".75em")
        .attr("y", 6)
        .style("text-anchor", "end")
        .text("Frequency");

//----------------------------LINES-----------------------------//
    const lines = svg3.selectAll("lines")
        .data(slices)
        .enter()
        .append("g");

    lines.append("path")
        .attr("class", ids)
        //.attr("class", "line-2")
        .attr("d", function (d) {
            return line(d.values);
        });

    lines.append("text")
        .attr("class", "serie_label")
        .datum(function (d) {
            return {
                id: d.id,
                value: d.values[d.values.length - 1]
            };
        })
        .attr("transform", function (d) {
            return "translate(" + (xScale(d.value.date) + 10)
                + "," + (yScale(d.value.measurement) + 5) + ")";
        })
        .attr("x", -150)
        .attr("y", -150)
        .text(function (d) {
            return ("Series ") + d.id;
        });

//})
});

////###############STOCHASTIC_OSCILATOR_SMA##############
// we are appending SVG first
const svg4 = d3.select("div#container").append("svg")
    .attr("chart", "stochastic_oscillator_sma")
    .attr("viewBox", "-"
          + adj + " -"
          + adj + " "
          + (width + adj *3) + " "
          + (height + adj*3))
    .style("padding", padding)
    .style("margin", margin)
    .classed("svg-content", true)

var stochastic_oscilator_sma = fetch(url)
    .then(response => response.json())
    .then(function(data) {

        //console.log(data)
        let time = data[0]['TradeDate']
        //var parseDate = d3.timeParse("%a, %d %b %Y %H:%M:%S GMT");
        var parseDate = d3.timeParse("%Y-%m-%d");
        //console.log(time)
        var inds = [{id: 'stochastic_oscillator_sma', values: []}]
        for (const [key, value] of Object.entries(data)) {
            let date = value.TradeDate;
            for (const [id, measurement] of Object.entries(value)) {
                if (id === 'stochastic_oscillator_sma') {
                    //console.log(measurement)
                    inds[0].values.push({date: parseDate(date), measurement: +measurement})
                }

            }
        }

    slices = inds

    //console.log(typeof slices)

//----------------------------SCALES----------------------------//
    const xScale = d3.scaleTime().range([0, width]);
    const yScale = d3.scaleLinear().rangeRound([height, 0]);
    xScale.domain(d3.extent(data, function (d) {
        return parseDate(d.TradeDate)
    }));
    yScale.domain([(0), (100)]);

//-----------------------------AXES-----------------------------//
    const yaxis = d3.axisLeft()
        .ticks(20)
        .scale(yScale);

    const xaxis = d3.axisBottom()
        .ticks(50)
        .tickFormat(d3.timeFormat('%b %d'))
        .scale(xScale);

//----------------------------LINES-----------------------------//
    const line = d3.line()
        .x(function (d) {
            return xScale(d.date);
        })
        .y(function (d) {
            return yScale(d.measurement);
        });

    let id = 0;
    const ids = function () {
        console.log("line-" + id)
        return "line-" + id++;
    }
//-------------------------2. DRAWING---------------------------//
//-----------------------------AXES-----------------------------//
    svg4.append("g")
        .attr("class", "axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xaxis);

    svg4.append("g")
        .attr("class", "axis")
        .call(yaxis)
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("dy", ".75em")
        .attr("y", 6)
        .style("text-anchor", "end")
        .text("Frequency");

//----------------------------LINES-----------------------------//
    const lines = svg4.selectAll("lines")
        .data(slices)
        .enter()
        .append("g");

    lines.append("path")
        .attr("class", ids)
        //.attr("class", "line-2")
        .attr("d", function (d) {
            return line(d.values);
        });

    lines.append("text")
        .attr("class", "serie_label")
        .datum(function (d) {
            return {
                id: d.id,
                value: d.values[d.values.length - 1]
            };
        })
        .attr("transform", function (d) {
            return "translate(" + (xScale(d.value.date) + 10)
                + "," + (yScale(d.value.measurement) + 5) + ")";
        })
        .attr("x", -150)
        .attr("y", -150)
        .text(function (d) {
            return ("Series ") + d.id;
        });

//})
});

//#########avg_compound_sentiment################
// we are appending SVG first
const svg5 = d3.select("div#container").append("svg")
    .attr("chart", "avg_compound_sentiment")
    .attr("viewBox", "-"
          + adj + " -"
          + adj + " "
          + (width + adj *3) + " "
          + (height + adj*3))
    .style("padding", padding)
    .style("margin", margin)
    .classed("svg-content", true)

var avg_compound_sentiment = fetch(url)
    .then(response => response.json())
    .then(function(data) {

        //console.log(data)
        let time = data[0]['TradeDate']
        //var parseDate = d3.timeParse("%a, %d %b %Y %H:%M:%S GMT");
        var parseDate = d3.timeParse("%Y-%m-%d");
        //console.log(time)
        var inds = [{id: 'avg_compound_sentiment', values: []}]
        for (const [key, value] of Object.entries(data)) {
            let date = value.TradeDate;
            for (const [id, measurement] of Object.entries(value)) {
                if (id === 'avg_compound_sentiment') {
                    //console.log(measurement)
                    inds[0].values.push({date: parseDate(date), measurement: +measurement})
                }

            }
        }

    slices = inds

    //console.log(typeof slices)

//----------------------------SCALES----------------------------//
    const xScale = d3.scaleTime().range([0, width]);
    const yScale = d3.scaleLinear().rangeRound([height, 0]);
    xScale.domain(d3.extent(data, function (d) {
        return parseDate(d.TradeDate)
    }));
    yScale.domain([(-1), (1)]);

//-----------------------------AXES-----------------------------//
    const yaxis = d3.axisLeft()
        .ticks(20)
        .scale(yScale);

    const xaxis = d3.axisBottom()
        .ticks(50)
        .tickFormat(d3.timeFormat('%b %d'))
        .scale(xScale);

//----------------------------LINES-----------------------------//
    const line = d3.line()
        .x(function (d) {
            return xScale(d.date);
        })
        .y(function (d) {
            return yScale(d.measurement);
        });

    let id = 0;
    const ids = function () {
        console.log("line-" + id)
        return "line-" + id++;
    }
//-------------------------2. DRAWING---------------------------//
//-----------------------------AXES-----------------------------//
    svg5.append("g")
        .attr("class", "axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xaxis);

    svg5.append("g")
        .attr("class", "axis")
        .call(yaxis)
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("dy", ".75em")
        .attr("y", 6)
        .style("text-anchor", "end")
        .text("Frequency");

//----------------------------LINES-----------------------------//
    const lines = svg5.selectAll("lines")
        .data(slices)
        .enter()
        .append("g");

    lines.append("path")
        .attr("class", ids)
        //.attr("class", "line-2")
        .attr("d", function (d) {
            return line(d.values);
        });

    lines.append("text")
        .attr("class", "serie_label")
        .datum(function (d) {
            return {
                id: d.id,
                value: d.values[d.values.length - 1]
            };
        })
        .attr("transform", function (d) {
            return "translate(" + (xScale(d.value.date) + 10)
                + "," + (yScale(d.value.measurement) + 5) + ")";
        })
        .attr("x", -150)
        .attr("y", -150)
        .text(function (d) {
            return ("Series ") + d.id;
        });

//})
});

//#########tweet_volume################
// we are appending SVG first
const svg6 = d3.select("div#container").append("svg")
    .attr("chart", "tweet_volume")
    .attr("viewBox", "-"
          + adj + " -"
          + adj + " "
          + (width + adj *3) + " "
          + (height + adj*3))
    .style("padding", padding)
    .style("margin", margin)
    .classed("svg-content", true)

var tweet_volume = fetch(url)
    .then(response => response.json())
    .then(function(data) {

        //console.log(data)
        let time = data[0]['TradeDate']
        //var parseDate = d3.timeParse("%a, %d %b %Y %H:%M:%S GMT");
        var parseDate = d3.timeParse("%Y-%m-%d");
        //console.log(time)
        var inds = [{id: 'tweet_volume', values: []}]
        for (const [key, value] of Object.entries(data)) {
            let date = value.TradeDate;
            for (const [id, measurement] of Object.entries(value)) {
                if (id === 'tweet_volume') {
                    //console.log(measurement)
                    inds[0].values.push({date: parseDate(date), measurement: +measurement})
                }

            }
        }

    slices = inds

    //console.log(typeof slices)

//----------------------------SCALES----------------------------//
    const xScale = d3.scaleTime().range([0, width]);
    const yScale = d3.scaleLinear().rangeRound([height, 0]);
    xScale.domain(d3.extent(data, function (d) {
        return parseDate(d.TradeDate)
    }));
    yScale.domain([(0), (10000)]);

//-----------------------------AXES-----------------------------//
    const yaxis = d3.axisLeft()
        .ticks(20)
        .scale(yScale);

    const xaxis = d3.axisBottom()
        .ticks(50)
        .tickFormat(d3.timeFormat('%b %d'))
        .scale(xScale);

//----------------------------LINES-----------------------------//
    const line = d3.line()
        .x(function (d) {
            return xScale(d.date);
        })
        .y(function (d) {
            return yScale(d.measurement);
        });

    let id = 0;
    const ids = function () {
        console.log("line-" + id)
        return "line-" + id++;
    }
//-------------------------2. DRAWING---------------------------//
//-----------------------------AXES-----------------------------//
    svg6.append("g")
        .attr("class", "axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xaxis);

    svg6.append("g")
        .attr("class", "axis")
        .call(yaxis)
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("dy", ".75em")
        .attr("y", 6)
        .style("text-anchor", "end")
        .text("Frequency");

//----------------------------LINES-----------------------------//
    const lines = svg6.selectAll("lines")
        .data(slices)
        .enter()
        .append("g");

    lines.append("path")
        .attr("class", ids)
        //.attr("class", "line-2")
        .attr("d", function (d) {
            return line(d.values);
        });

    lines.append("text")
        .attr("class", "serie_label")
        .datum(function (d) {
            return {
                id: d.id,
                value: d.values[d.values.length - 1]
            };
        })
        .attr("transform", function (d) {
            return "translate(" + (xScale(d.value.date) + 10)
                + "," + (yScale(d.value.measurement) + 5) + ")";
        })
        .attr("x", -150)
        .attr("y", -150)
        .text(function (d) {
            return ("Series ") + d.id;
        });

//})
});




</script>
</body>